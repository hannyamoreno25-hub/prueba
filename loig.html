<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOIG</title>
    <link rel="stylesheet" href="estiloloing.css">
    <link href='https://cdn.boxicons.com/3.0.3/fonts/basic/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <div class="wrapper">
        <form id="loginForm" >
            <h1>Iniciar sesión</h1>
            <div class="input-box">
                <input type="text" placeholder="Usuario" required id="usuario">
                <i class='bxrds bx-user'></i>
            </div>
            <div class="input-box">
                <input type="password" placeholder="Contraseña" required id="password">
                <i class='bxrds bx-lock'></i>
            </div>
            <div class="remember-forgot">
                <label><input type="checkbox">Recordarme</label>
                <a href="#">¿Olvidaste tu contraseña?</a>
            </div>
            <button onclick="login(event)" type="submit" class="btn">Login</button>
            <div id="msg" style="color: red; margin-top: 10px;"></div> 
            <div class="register-link">
                <p>¿No tiene una cuenta? <a href="#">Registrar</a></p>
            </div>
        </form>
    </div>

    <script>
        // URL de tu Google Apps Script
        const URL = "https://script.google.com/macros/s/AKfycbxtihR0-yJXtmNM89TKiyZvBdksRjmrZ_Uhn2Rszqxc-h27S1FmEA4ogyW6oquCxAbD/exec";

        async function login(event) {
            // Evitamos que se recargue la página
            event.preventDefault(); 
            
            const usuario = document.getElementById("usuario").value;
            const password = document.getElementById("password").value;
            const msgElement = document.getElementById("msg");

            msgElement.innerText = "Verificando...";
            msgElement.style.color = "blue";

            try {
                // Petición al servidor
                const res = await fetch(URL, {
                    method: "POST",
                    body: JSON.stringify({ usuario, password })
                });

                const data = await res.json();

                if (data.ok) {
                    msgElement.style.color = "green";
                    msgElement.innerText = "Bienvenido " + data.nombre;

                    // Guardamos el rol en la memoria del navegador
                    localStorage.setItem("usuario_rol", data.rol);
                    localStorage.setItem("usuario_nombre", data.nombre);

                    // Redirección inteligente
                    setTimeout(() => {
                        // Convertimos a minúsculas para evitar errores
                        const rolDetectado = data.rol.toString().toLowerCase().trim();

                        if (rolDetectado === "admin" || rolDetectado === "administrador") {
                            // Si es Admin va a colaborador.html
                            window.location.href = "colaborador.html"; 
                        } else {
                            // CORREGIDO: Si es Monitor va a index.html (ruta relativa)
                            window.location.href = "index.html"; 
                        }
                    }, 1000);

                } else {
                    msgElement.style.color = "red";
                    msgElement.innerText = data.error || "Datos incorrectos.";
                }

            } catch (err) {
                console.error(err);
                msgElement.style.color = "red";
                msgElement.innerText = "Error de conexión.";
            }
        }
    </script>
</body>
</html>